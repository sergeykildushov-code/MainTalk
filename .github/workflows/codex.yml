name: ChatGPT Codex Task
on:
  workflow_dispatch:
    inputs:
      prompt:
        description: "–í–≤–µ–¥–∏—Ç–µ –∑–∞–ø—Ä–æ—Å –¥–ª—è ChatGPT Codex"
        required: true
        default: "–ê–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –≤–µ—Ç–∫—É OriginalCode/2.0.1-beta"

jobs:
  run-codex:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Send task to ChatGPT Codex API
        env:
          OPENAI_API_KEY: ${{ secrets.OPENAI_API_KEY }}
        run: |
          echo "üîç –û—Ç–ø—Ä–∞–≤–∫–∞ –∑–∞–ø—Ä–æ—Å–∞ –≤ ChatGPT Codex..."
          curl https://api.openai.com/v1/chat/completions \
            -H "Content-Type: application/json" \
            -H "Authorization: Bearer $OPENAI_API_KEY" \
            -d "{
              \"model\": \"gpt-4o-mini\",
              \"messages\": [
                {\"role\": \"system\", \"content\": \"–¢—ã ‚Äî GitHub Codex-–∞–Ω–∞–ª–∏—Ç–∏–∫. –ê–Ω–∞–ª–∏–∑–∏—Ä—É–π –∫–æ–¥ –∏ –≤–æ–∑–≤—Ä–∞—â–∞–π —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã.\"},
                {\"role\": \"user\", \"content\": \"${{ github.event.inputs.prompt }}\"}
              ]
            }" > codex_output.json

      - name: Save result
        run: |
          mkdir -p reports
          jq -r '.choices[0].message.content' codex_output.json > reports/analysis_codex_result.md
          echo "‚úÖ –†–µ–∑—É–ª—å—Ç–∞—Ç —Å–æ—Ö—Ä–∞–Ω—ë–Ω –≤ reports/analysis_codex_result.md"

      - name: Upload result as artifact
        uses: actions/upload-artifact@v4
        with:
          name: ChatGPT-Codex-Result
          path: reports/analysis_codex_result.md
